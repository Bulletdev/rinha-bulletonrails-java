# üêì Rinha de Backend - Nerfa mais a JVM  ‚òï 

<details align="left">

<div>

 <h1>  
 Signatures:
 </h1>

                   ‚¢Ä‚£¥‚£ø‚£ø‚£ø‚£ø‚£ø‚£∂‚£∂‚£∂‚£ø‚£ø‚£∂‚£∂‚£∂‚£∂‚£∂‚£ø‚°ø‚£ø‚£æ‚£∑‚£∂‚£∂‚£æ‚£ø‚†Ä                                                                                                                          
                 ‚£†‚£ø‚£ø‚¢ø‚£ø‚£Ø‚†Ä‚¢π‚£ø‚£ø‚£ø‚£ø‚£ø‚£ø‚£ø‚£ø‚£ø‚£ø‚£ø‚°á‚£ø‚°á‚£ø‚£ø‚£ø‚£ø‚£ø‚°á                                                                                                         
             ‚†Ä‚£∞‚£ø‚£ø‚£∑‚°ü‚†§‚†ü‚†Å‚£º‚£ø‚£ø‚£ø‚£ø‚£ø‚£ø‚£ø‚£ø‚£ø‚£ø‚£ø‚£ø‚¢∏‚°á‚£ø‚£ø‚£ø‚£ø‚£ø‚°á 
             ‚†Ä‚£ø‚£ø‚£ø‚£ø‚£ø‚£∑‚£∂‚£ø‚£ø‚°ü‚†Å‚£Æ‚°ª‚£ø‚£ø‚£ø‚£ø‚£ø‚£ø‚£ø‚£ø‚¢∏‚°á‚£ø‚£ø‚£ø‚£ø‚£ø‚°á 
             ‚†ò‚£ø‚£ø‚£ø‚£ø‚£ø‚£ø‚£ø‚£ø‚†è‚†Ä‚†Ä‚£ø‚£ø‚£π‚£ø‚£ø‚£ø‚£ø‚£ø‚£ø‚°ø‚¢∏‚°á‚£ø‚£ø‚£ø‚£ø‚£ø‚°á 
             ‚†Ä‚†ô‚¢ø‚£ø‚£ø‚£ø‚°ø‚†ü‚†Å‚£ø‚£ø‚£∂‚£ø‚†ü‚¢ª‚£ø‚£ø‚£ø‚£ø‚£ø‚£ø‚°á‚£º‚°á‚£ø‚£ø‚£ø‚£ø‚£ø‚†á
             ‚†Ä‚†Ä‚†à‚†ã‚†â‚†Å‚£∂‚£∂‚£∂‚£ø‚£ø‚£ø‚£ø‚¢Ä‚£ø‚£ø‚£ø‚£ø‚£ø‚£ø‚£ø‚£á‚£ø‚¢∞‚£ø‚£ø‚£ø‚£ø‚£ø‚†Ä 
             ‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†ô‚†ø‚£ø‚£ø‚£ø‚°Ñ‚¢Ä‚£†‚£æ‚£ø‚£ø‚£ø‚£ø‚£ø‚£ø‚£ø‚£Ω‚£ø‚£º‚£ø‚£ø‚£ø‚£ø‚†á‚†Ä 
             ‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†à‚†â‚†í‚†ö‚†ø‚†ø‚†ø‚†ø‚†ø‚†ø‚†ø‚†ø‚†ø‚†ø‚†õ‚†ø‚†ø‚†ø‚†ø‚†ø‚†ã‚†Ä‚†Ä 
             ‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä 
             ‚†Ä‚†Ä‚†Ä‚£ø‚£ô‚°Ü‚†Ä‚†Ä‚°á‚†Ä‚¢∏‚†Ä‚†Ä‚¢∏‚†Ä‚†Ä ‚¢∏‚°á‚†Ä‚†Ä‚¢∏‚£è‚°â  ‚†ô‚°è‚†Å‚†Ä 
             ‚†Ä‚†Ä‚†Ä‚£ø‚£â‚°∑‚†Ä‚†Ä‚¢ß‚£Ä‚£º ‚†Ä‚¢∏‚£Ä  ‚¢∏‚£á‚°Ä ‚¢∏‚£è‚£Å‚†Ä ‚†Ä‚°á‚†Ä 


  </div>

</details>

![Boleto](assets/javapagou.png)

##  Estrat√©gia de Performance

Esta implementa√ß√£o foi otimizada para **m√°xima performance** e **menor custo por transa√ß√£o**

### Otimiza√ß√µes Principais

- **Undertow** ao inv√©s de Tomcat (30% mais r√°pido)
- **Processamento ass√≠ncrono** em lotes com filas otimizadas
- **Health Check inteligente** com cache de 5s e fallback autom√°tico
- **Pool de conex√µes HTTP** otimizado com keep-alive
- **Repository em mem√≥ria** com estruturas lock-free (LongAdder)
- **JVM tuning agressivo** para baixa lat√™ncia



###  Estrat√©gia de Escolha de Processador

1. **Health Check peri√≥dico** a cada 5s respeitando rate limit
2. **Score inteligente**: tempo de resposta + disponibilidade
3. **Prefer√™ncia pelo default** (menor taxa) com toler√¢ncia 1.5x no tempo
4. **Circuit breaker** autom√°tico com retry e fallback
5. **Fallback inteligente** quando processador principal falha

### ‚ö° Otimiza√ß√µes de Performance

- **Virtual Threads** para I/O n√£o-bloqueante
- **G1GC** com pausa m√°xima de 10ms
- **String deduplication** para economia de mem√≥ria
- **Tiered compilation** nivel 1 para startup r√°pido
- **Buffer sizes** otimizados (1KB-4KB)
- **Keep-alive** em todas as conex√µes HTTP

### Configura√ß√µes de Recursos

- **CPU**: 1.5 cores total (0.6 por backend + 0.3 nginx)
- **Mem√≥ria**: 350MB total (125MB por backend + 100MB nginx)
- **Threads**: 20 workers + 4 I/O por inst√¢ncia
- **Connections**: Pool de 50 conex√µes HTTP com keep-alive

### Tecnologias Utilizadas

- **Java 21** com Virtual Threads
- **Spring Boot 3.3** com WebFlux
- **Undertow** como servidor web
- **Nginx** com least_conn balancing
- **Caffeine** cache local
- **Repository in-memory** otimizado

### üèÉ‚Äç‚ôÇ Como Executar

```bash
# 1. Subir os Payment Processors primeiro
cd payment-processor
docker-compose up -d

# 2. Subir o backend
docker-compose up -d

# 3. Testar
curl -X POST http://localhost:9999/payments \
  -H "Content-Type: application/json" \
  -d '{"correlationId": "550e8400-e29b-41d4-a716-446655440000", "amount": 19.90}'

curl http://localhost:9999/payments-summary
```

### Objetivo

**Maximizar o lucro** processando o m√°ximo de pagamentos poss√≠vel com a **menor taxa** (processador default), mantendo **alta disponibilidade** e **baixa lat√™ncia** (p99 < 10ms para b√¥nus de performance).

---

** Feito com ‚ù§Ô∏è e bastante ‚òï para a üêì Rinha **
